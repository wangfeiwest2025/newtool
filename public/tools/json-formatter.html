<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Formatter - New ToolsHub</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõ†Ô∏è</text></svg>">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/fontawesome-all.min.css">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#007bff">
    <style>
        .json-editor {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .json-editor {
                grid-template-columns: 1fr;
            }
        }
        
        .editor-panel {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .panel-header {
            background: #f8f9fa;
            padding: 10px 15px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .panel-title {
            font-weight: 600;
            margin: 0;
        }
        
        .editor-textarea {
            width: 100%;
            min-height: 400px;
            border: none;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            outline: none;
            background: #fafafa;
        }
        
        .json-output {
            width: 100%;
            min-height: 400px;
            border: none;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            outline: none;
            background: white;
            white-space: pre-wrap;
            overflow: auto;
            margin: 0;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .validation-status {
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }
        
        .validation-status.valid {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .validation-status.invalid {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .toolbar {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .toolbar-group {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .toolbar-label {
            font-weight: 600;
            margin-right: 10px;
            color: #495057;
        }
        
        .indent-selector {
            width: 100px;
        }
        
        .stats-panel {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .tree-key {
            color: #d73a49;
        }
        
        .tree-string {
            color: #032f62;
        }
        
        .tree-number {
            color: #005cc5;
        }
        
        .tree-boolean {
            color: #d73a49;
        }
        
        .tree-null {
            color: #6f42c1;
        }
        
        .sample-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .convert-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .convert-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg" style="background: linear-gradient(135deg, #4361ee, #3f37c9); padding: 1rem 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <div class="container">
            <a class="navbar-brand" href="/" style="color: white; font-weight: 700; display: flex; align-items: center;">
                <i class="fas fa-tools"></i> New ToolsHub
            </a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="tool-container">
            <div class="tool-header">
                <h1 class="tool-title"><i class="fas fa-code"></i> JSON Formatter</h1>
                <p class="tool-description">Format, validate, compress, and convert JSON data. Features syntax highlighting, tree view, and statistics.</p>
            </div>
            
            <div class="sample-buttons">
                <button class="btn btn-outline-secondary btn-sm" onclick="loadSample('simple')">
                    <i class="fas fa-file-code"></i> Simple
                </button>
                <button class="btn btn-outline-secondary btn-sm" onclick="loadSample('nested')">
                    <i class="fas fa-sitemap"></i> Nested
                </button>
                <button class="btn btn-outline-secondary btn-sm" onclick="loadSample('array')">
                    <i class="fas fa-list"></i> Array
                </button>
                <button class="btn btn-outline-secondary btn-sm" onclick="loadSample('complex')">
                    <i class="fas fa-database"></i> Complex
                </button>
            </div>
            
            <div class="toolbar">
                <div class="toolbar-group">
                    <span class="toolbar-label">Indent:</span>
                    <select id="indentSize" class="form-control indent-selector">
                        <option value="2">2 spaces</option>
                        <option value="4" selected>4 spaces</option>
                        <option value="\t">Tab</option>
                    </select>
                </div>
                <div class="toolbar-group">
                    <button id="formatBtn" class="btn btn-primary">
                        <i class="fas fa-align-left"></i> Format
                    </button>
                    <button id="minifyBtn" class="btn btn-warning">
                        <i class="fas fa-compress"></i> Minify
                    </button>
                    <button id="validateBtn" class="btn btn-info">
                        <i class="fas fa-check-circle"></i> Validate
                    </button>
                </div>
                <div class="toolbar-group">
                    <button id="sortBtn" class="btn btn-outline-primary">
                        <i class="fas fa-sort-alpha-down"></i> Sort
                    </button>
                    <button id="escapeBtn" class="btn btn-outline-secondary">
                        <i class="fas fa-terminal"></i> Escape
                    </button>
                    <button id="unescapeBtn" class="btn btn-outline-secondary">
                        <i class="fas fa-code"></i> Unescape
                    </button>
                </div>
                <div class="toolbar-group">
                    <button id="copyBtn" class="btn btn-success">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                    <button id="clearBtn" class="btn btn-outline-danger">
                        <i class="fas fa-trash"></i> Clear
                    </button>
                    <button id="downloadBtn" class="btn btn-outline-primary">
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
            </div>
            
            <div id="validationStatus" class="validation-status"></div>
            
            <div class="json-editor">
                <div class="editor-panel">
                    <div class="panel-header">
                        <h5 class="panel-title"><i class="fas fa-edit"></i> Input JSON</h5>
                        <small class="text-muted">Paste your JSON here</small>
                    </div>
                    <textarea id="jsonInput" class="editor-textarea" placeholder="Paste your JSON here..."></textarea>
                </div>
                
                <div class="editor-panel">
                    <div class="panel-header">
                        <h5 class="panel-title"><i class="fas fa-eye"></i> Formatted Output</h5>
                        <small class="text-muted">Formatted result</small>
                    </div>
                    <pre id="jsonOutput" class="json-output"></pre>
                </div>
            </div>
            
            <div class="convert-section">
                <h5><i class="fas fa-exchange-alt"></i> JSON Converters</h5>
                <div class="convert-grid">
                    <button class="btn btn-outline-primary" onclick="convertToXML()">
                        <i class="fas fa-file-code"></i> JSON to XML
                    </button>
                    <button class="btn btn-outline-primary" onclick="convertToCSV()">
                        <i class="fas fa-file-csv"></i> JSON to CSV
                    </button>
                    <button class="btn btn-outline-primary" onclick="convertToYAML()">
                        <i class="fas fa-file-alt"></i> JSON to YAML
                    </button>
                    <button class="btn btn-outline-primary" onclick="convertToProperties()">
                        <i class="fas fa-cog"></i> JSON to Properties
                    </button>
                </div>
            </div>
            
            <div class="stats-panel">
                <h5><i class="fas fa-chart-bar"></i> JSON Statistics</h5>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="statSize">0</div>
                        <div class="stat-label">Size (bytes)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statLines">0</div>
                        <div class="stat-label">Lines</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statKeys">0</div>
                        <div class="stat-label">Keys</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statDepth">0</div>
                        <div class="stat-label">Max Depth</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statArrays">0</div>
                        <div class="stat-label">Arrays</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statObjects">0</div>
                        <div class="stat-label">Objects</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>New ToolsHub - Inspired by xJavaFxTool | Comprehensive Developer Tools</p>
        </div>
    </footer>

    <script>
        const samples = {
            simple: {
                name: "John Doe",
                age: 30,
                email: "john.doe@example.com",
                isActive: true
            },
            nested: {
                user: {
                    name: "John Doe",
                    contact: {
                        email: "john@example.com",
                        phone: "+1234567890",
                        address: {
                            street: "123 Main St",
                            city: "New York",
                            country: "USA"
                        }
                    }
                },
                metadata: {
                    created: new Date().toISOString(),
                    version: "1.0"
                }
            },
            array: [
                { id: 1, name: "Item 1", price: 10.99 },
                { id: 2, name: "Item 2", price: 25.50 },
                { id: 3, name: "Item 3", price: 5.75 }
            ],
            complex: {
                company: "TechCorp",
                employees: [
                    { id: 1, name: "Alice", department: "Engineering", skills: ["JavaScript", "Python"] },
                    { id: 2, name: "Bob", department: "Design", skills: ["Figma", "Sketch"] }
                ],
                metrics: {
                    revenue: 15000000,
                    growth: 0.25
                }
            }
        };

        const jsonInput = document.getElementById('jsonInput');
        const jsonOutput = document.getElementById('jsonOutput');
        const indentSize = document.getElementById('indentSize');
        const validationStatus = document.getElementById('validationStatus');

        function loadSample(type) {
            jsonInput.value = JSON.stringify(samples[type], null, 4);
            formatJSON();
        }

        function formatJSON() {
            const input = jsonInput.value.trim();
            if (!input) {
                jsonOutput.innerHTML = '';
                updateStats('');
                return;
            }
            
            try {
                const parsed = JSON.parse(input);
                const indent = indentSize.value === '\\t' ? '\\t' : parseInt(indentSize.value);
                const formatted = JSON.stringify(parsed, null, indent);
                jsonOutput.innerHTML = syntaxHighlight(formatted);
                showValidationStatus(true, 'Valid JSON');
                updateStats(input);
            } catch (e) {
                jsonOutput.textContent = input;
                showValidationStatus(false, 'Invalid JSON: ' + e.message);
            }
        }

        function minifyJSON() {
            const input = jsonInput.value.trim();
            if (!input) return;
            
            try {
                const parsed = JSON.parse(input);
                const minified = JSON.stringify(parsed);
                jsonOutput.textContent = minified;
                jsonInput.value = minified;
                showValidationStatus(true, 'JSON minified successfully');
                updateStats(minified);
            } catch (e) {
                showValidationStatus(false, 'Invalid JSON: ' + e.message);
            }
        }

        function validateJSON() {
            const input = jsonInput.value.trim();
            if (!input) {
                showValidationStatus(false, 'Please enter JSON to validate');
                return;
            }
            
            try {
                JSON.parse(input);
                showValidationStatus(true, 'Valid JSON ‚úì');
            } catch (e) {
                showValidationStatus(false, 'Invalid JSON: ' + e.message);
            }
        }

        function sortKeys(obj) {
            if (Array.isArray(obj)) {
                return obj.map(sortKeys);
            } else if (obj !== null && typeof obj === 'object') {
                return Object.keys(obj).sort().reduce((result, key) => {
                    result[key] = sortKeys(obj[key]);
                    return result;
                }, {});
            }
            return obj;
        }

        function sortJSON() {
            const input = jsonInput.value.trim();
            if (!input) return;
            
            try {
                const parsed = JSON.parse(input);
                const sorted = sortKeys(parsed);
                const indent = indentSize.value === '\\t' ? '\\t' : parseInt(indentSize.value);
                const formatted = JSON.stringify(sorted, null, indent);
                jsonOutput.innerHTML = syntaxHighlight(formatted);
                jsonInput.value = formatted;
                showValidationStatus(true, 'JSON keys sorted');
            } catch (e) {
                showValidationStatus(false, 'Invalid JSON: ' + e.message);
            }
        }

        function escapeJSON() {
            const input = jsonInput.value.trim();
            if (!input) return;
            const escaped = input.replace(/\\/g, '\\\\').replace(/"/g, '\\"').replace(/\\n/g, '\\n').replace(/\\r/g, '\\r').replace(/\\t/g, '\\t');
            jsonOutput.textContent = escaped;
            showValidationStatus(true, 'JSON escaped');
        }

        function unescapeJSON() {
            const input = jsonInput.value.trim();
            if (!input) return;
            const unescaped = input.replace(/\\n/g, '\n').replace(/\\r/g, '\r').replace(/\\t/g, '\t').replace(/\\"/g, '"').replace(/\\\\/g, '\\');
            jsonOutput.textContent = unescaped;
            jsonInput.value = unescaped;
            showValidationStatus(true, 'JSON unescaped');
        }

        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function(match) {
                let cls = 'tree-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'tree-key';
                    } else {
                        cls = 'tree-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'tree-boolean';
                } else if (/null/.test(match)) {
                    cls = 'tree-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }

        function showValidationStatus(isValid, message) {
            validationStatus.className = 'validation-status ' + (isValid ? 'valid' : 'invalid');
            validationStatus.innerHTML = '<i class="fas fa-' + (isValid ? 'check-circle' : 'exclamation-circle') + '"></i> ' + message;
        }

        function updateStats(json) {
            if (!json) {
                ['statSize', 'statLines', 'statKeys', 'statDepth', 'statArrays', 'statObjects'].forEach(id => {
                    document.getElementById(id).textContent = '0';
                });
                return;
            }
            
            try {
                const parsed = JSON.parse(json);
                const size = new Blob([json]).size;
                const lines = json.split('\n').length;
                const stats = calculateStats(parsed);
                
                document.getElementById('statSize').textContent = size.toLocaleString();
                document.getElementById('statLines').textContent = lines;
                document.getElementById('statKeys').textContent = stats.keys;
                document.getElementById('statDepth').textContent = stats.depth;
                document.getElementById('statArrays').textContent = stats.arrays;
                document.getElementById('statObjects').textContent = stats.objects;
            } catch (e) {}
        }

        function calculateStats(obj, depth = 0) {
            let stats = { keys: 0, depth: depth, arrays: 0, objects: 0 };
            
            if (Array.isArray(obj)) {
                stats.arrays++;
                for (let item of obj) {
                    if (item !== null && typeof item === 'object') {
                        const childStats = calculateStats(item, depth + 1);
                        stats.keys += childStats.keys;
                        stats.depth = Math.max(stats.depth, childStats.depth);
                        stats.arrays += childStats.arrays;
                        stats.objects += childStats.objects;
                    }
                }
            } else if (obj !== null && typeof obj === 'object') {
                stats.objects++;
                const keys = Object.keys(obj);
                stats.keys += keys.length;
                for (let key of keys) {
                    const value = obj[key];
                    if (value !== null && typeof value === 'object') {
                        const childStats = calculateStats(value, depth + 1);
                        stats.keys += childStats.keys;
                        stats.depth = Math.max(stats.depth, childStats.depth);
                        stats.arrays += childStats.arrays;
                        stats.objects += childStats.objects;
                    }
                }
            }
            
            return stats;
        }

        function convertToXML() {
            const input = jsonInput.value.trim();
            if (!input) return;
            
            try {
                const parsed = JSON.parse(input);
                let xml = '<?xml version="1.0" encoding="UTF-8"?>\n<root>\n';
                xml += jsonToXml(parsed, 1);
                xml += '</root>';
                jsonOutput.textContent = xml;
                showValidationStatus(true, 'Converted to XML');
            } catch (e) {
                showValidationStatus(false, 'Invalid JSON: ' + e.message);
            }
        }

        function jsonToXml(obj, indent) {
            let xml = '';
            const spaces = '  '.repeat(indent);
            
            if (Array.isArray(obj)) {
                obj.forEach((item, index) => {
                    xml += spaces + '<item index="' + index + '">\n';
                    xml += jsonToXml(item, indent + 1);
                    xml += spaces + '</item>\n';
                });
            } else if (typeof obj === 'object' && obj !== null) {
                for (let key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        const value = obj[key];
                        if (typeof value === 'object' && value !== null) {
                            xml += spaces + '<' + key + '>\n';
                            xml += jsonToXml(value, indent + 1);
                            xml += spaces + '</' + key + '>\n';
                        } else {
                            xml += spaces + '<' + key + '>' + escapeXml(value) + '</' + key + '>\n';
                        }
                    }
                }
            } else {
                xml += spaces + escapeXml(obj) + '\n';
            }
            
            return xml;
        }

        function escapeXml(str) {
            if (str === null || str === undefined) return '';
            return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }

        function convertToCSV() {
            const input = jsonInput.value.trim();
            if (!input) return;
            
            try {
                const parsed = JSON.parse(input);
                if (!Array.isArray(parsed) || parsed.length === 0) {
                    showValidationStatus(false, 'JSON must be an array of objects');
                    return;
                }
                
                const headers = Object.keys(parsed[0]);
                let csv = headers.join(',') + '\n';
                
                parsed.forEach(row => {
                    const values = headers.map(h => {
                        const val = row[h];
                        if (val === null || val === undefined) return '';
                        const str = String(val);
                        if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                            return '"' + str.replace(/"/g, '""') + '"';
                        }
                        return str;
                    });
                    csv += values.join(',') + '\n';
                });
                
                jsonOutput.textContent = csv;
                showValidationStatus(true, 'Converted to CSV');
            } catch (e) {
                showValidationStatus(false, 'Error: ' + e.message);
            }
        }

        function convertToYAML() {
            const input = jsonInput.value.trim();
            if (!input) return;
            
            try {
                const parsed = JSON.parse(input);
                const yaml = jsonToYaml(parsed, 0);
                jsonOutput.textContent = yaml;
                showValidationStatus(true, 'Converted to YAML');
            } catch (e) {
                showValidationStatus(false, 'Invalid JSON: ' + e.message);
            }
        }

        function jsonToYaml(obj, indent) {
            let yaml = '';
            const spaces = '  '.repeat(indent);
            
            if (Array.isArray(obj)) {
                obj.forEach(item => {
                    if (typeof item === 'object' && item !== null) {
                        yaml += spaces + '-\n';
                        yaml += jsonToYaml(item, indent + 1);
                    } else {
                        yaml += spaces + '- ' + item + '\n';
                    }
                });
            } else if (typeof obj === 'object' && obj !== null) {
                for (let key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        const value = obj[key];
                        if (typeof value === 'object' && value !== null) {
                            yaml += spaces + key + ':\n';
                            yaml += jsonToYaml(value, indent + 1);
                        } else {
                            yaml += spaces + key + ': ' + value + '\n';
                        }
                    }
                }
            } else {
                yaml += spaces + obj + '\n';
            }
            
            return yaml;
        }

        function convertToProperties() {
            const input = jsonInput.value.trim();
            if (!input) return;
            
            try {
                const parsed = JSON.parse(input);
                const props = jsonToProperties(parsed, '');
                jsonOutput.textContent = props;
                showValidationStatus(true, 'Converted to Properties');
            } catch (e) {
                showValidationStatus(false, 'Invalid JSON: ' + e.message);
            }
        }

        function jsonToProperties(obj, prefix) {
            let props = '';
            
            for (let key in obj) {
                if (obj.hasOwnProperty(key)) {
                    const value = obj[key];
                    const newKey = prefix ? prefix + '.' + key : key;
                    
                    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
                        props += jsonToProperties(value, newKey);
                    } else {
                        props += newKey + '=' + value + '\n';
                    }
                }
            }
            
            return props;
        }

        document.getElementById('formatBtn').addEventListener('click', formatJSON);
        document.getElementById('minifyBtn').addEventListener('click', minifyJSON);
        document.getElementById('validateBtn').addEventListener('click', validateJSON);
        document.getElementById('sortBtn').addEventListener('click', sortJSON);
        document.getElementById('escapeBtn').addEventListener('click', escapeJSON);
        document.getElementById('unescapeBtn').addEventListener('click', unescapeJSON);
        document.getElementById('copyBtn').addEventListener('click', () => {
            const text = jsonOutput.textContent;
            if (text) ToolsHub.copyToClipboard(text);
        });
        document.getElementById('clearBtn').addEventListener('click', () => {
            jsonInput.value = '';
            jsonOutput.innerHTML = '';
            validationStatus.className = 'validation-status';
            validationStatus.innerHTML = '';
            updateStats('');
        });
        document.getElementById('downloadBtn').addEventListener('click', () => {
            const text = jsonInput.value.trim();
            if (!text) return;
            try {
                const parsed = JSON.parse(text);
                const formatted = JSON.stringify(parsed, null, 2);
                const blob = new Blob([formatted], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'data.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (e) {
                alert('Invalid JSON');
            }
        });

        let debounceTimer;
        jsonInput.addEventListener('input', () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(formatJSON, 500);
        });
        indentSize.addEventListener('change', formatJSON);

        window.addEventListener('load', () => loadSample('simple'));
    </script>
    <script src="../js/main.js"></script>
</body>
</html>
