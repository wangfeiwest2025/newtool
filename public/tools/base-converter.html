<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿›åˆ¶è½¬æ¢å™¨ - New ToolsHub</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ› ï¸</text></svg>">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/fontawesome-all.min.css">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#007bff">
    <style>
        .base-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .base-input label {
            min-width: 100px;
            font-weight: bold;
        }
        
        .base-input input {
            flex: 1;
            font-family: 'Courier New', monospace;
        }
        
        .base-badge {
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
        }
        
        .base-2 { background: #e3f2fd; color: #1565c0; }
        .base-8 { background: #e8f5e9; color: #2e7d32; }
        .base-10 { background: #fff3e0; color: #ef6c00; }
        .base-16 { background: #fce4ec; color: #c2185b; }
        .base-36 { background: #f3e5f5; color: #7b1fa2; }
        
        .bit-display {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            margin-top: 15px;
        }
        
        .bit {
            width: 12px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-family: monospace;
            border-radius: 2px;
        }
        
        .bit-0 { background: #e9ecef; color: #6c757d; }
        .bit-1 { background: #28a745; color: white; }
        
        .byte-group {
            display: flex;
            gap: 4px;
            margin: 2px;
        }
        
        .byte-label {
            font-size: 9px;
            color: #6c757d;
            text-align: center;
            margin-top: 2px;
        }
        
        .ascii-table {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background: #1a1a2e;
            color: #00ff88;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
        
        .ascii-row {
            display: flex;
            gap: 10px;
            margin-bottom: 5px;
        }
        
        .ascii-item {
            min-width: 80px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg" style="background: linear-gradient(135deg, #007bff, #0056b3); padding: 1rem 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <div class="container">
            <a class="navbar-brand" href="/" style="color: white; font-weight: 700; display: flex; align-items: center;">
                <i class="fas fa-tools"></i> New ToolsHub
            </a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="tool-container">
            <div class="tool-header">
                <h1 class="tool-title"><i class="fas fa-calculator"></i> è¿›åˆ¶è½¬æ¢å™¨</h1>
                <p class="tool-description">æ”¯æŒäºŒè¿›åˆ¶ã€å…«è¿›åˆ¶ã€åè¿›åˆ¶ã€åå…­è¿›åˆ¶ã€Base36 ä¹‹é—´çš„ç›¸äº’è½¬æ¢ã€‚æ”¯æŒ Unicode å’Œ ASCII ç¼–ç æŸ¥çœ‹ã€‚</p>
            </div>
            
            <div class="tool-content">
                <div class="row">
                    <div class="col-md-6">
                        <div class="base-input">
                            <span class="base-badge base-2">äºŒè¿›åˆ¶</span>
                            <input type="text" id="binInput" class="form-control" placeholder="è¾“å…¥äºŒè¿›åˆ¶æ•° (å¦‚ 1010)" maxlength="64">
                        </div>
                        <div class="base-input">
                            <span class="base-badge base-8">å…«è¿›åˆ¶</span>
                            <input type="text" id="octInput" class="form-control" placeholder="è¾“å…¥å…«è¿›åˆ¶æ•° (å¦‚ 755)" maxlength="22">
                        </div>
                        <div class="base-input">
                            <span class="base-badge base-10">åè¿›åˆ¶</span>
                            <input type="text" id="decInput" class="form-control" placeholder="è¾“å…¥åè¿›åˆ¶æ•° (å¦‚ 255)" maxlength="20">
                        </div>
                        <div class="base-input">
                            <span class="base-badge base-16">åå…­è¿›åˆ¶</span>
                            <input type="text" id="hexInput" class="form-control" placeholder="è¾“å…¥åå…­è¿›åˆ¶æ•° (å¦‚ ff)" maxlength="16">
                        </div>
                        <div class="base-input">
                            <span class="base-badge base-36">Base36</span>
                            <input type="text" id="base36Input" class="form-control" placeholder="è¾“å…¥ Base36 (å¦‚ z)" maxlength="14">
                        </div>
                        
                        <div class="action-buttons mt-3">
                            <button id="convertBtn" class="btn btn-primary">
                                <i class="fas fa-sync-alt"></i> è½¬æ¢
                            </button>
                            <button id="clearBtn" class="btn btn-outline-secondary">
                                <i class="fas fa-trash-alt"></i> æ¸…ç©º
                            </button>
                        </div>
                        
                        <div class="mt-4">
                            <h6>å¿«æ·æ“ä½œ:</h6>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-primary" id="randomBtn">éšæœºæ•°</button>
                                <button class="btn btn-sm btn-outline-primary" id="maxUint8Btn">255 (Uint8)</button>
                                <button class="btn btn-sm btn-outline-primary" id="maxUint16Btn">65535 (Uint16)</button>
                                <button class="btn btn-sm btn-outline-primary" id="maxUint32Btn">4294967295</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-info-circle"></i> æ•°å€¼ä¿¡æ¯
                            </div>
                            <div class="card-body" id="valueInfo">
                                <div class="text-muted text-center py-4">
                                    è¾“å…¥æ•°å€¼åæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mt-3">
                            <div class="card-header">
                                <i class="fas fa-code"></i> ASCII / Unicode
                            </div>
                            <div class="card-body">
                                <div id="asciiDisplay" class="ascii-table" style="display: none;"></div>
                                <div id="asciiPlaceholder" class="text-muted text-center py-2">
                                    å•ä¸ªå­—ç¬¦æ—¶æ˜¾ç¤º ASCII/Unicode ä¿¡æ¯
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <div class="card-header">
                        <i class="fas fa-layer-group"></i> ä½è§†å›¾ (äºŒè¿›åˆ¶è¡¨ç¤º)
                    </div>
                    <div class="card-body">
                        <div id="bitDisplay" class="bit-display"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>New ToolsHub - Inspired by xJavaFxTool | Comprehensive Developer Tools</p>
        </div>
    </footer>

    <script>
        // DOM Elements
        const binInput = document.getElementById('binInput');
        const octInput = document.getElementById('octInput');
        const decInput = document.getElementById('decInput');
        const hexInput = document.getElementById('hexInput');
        const base36Input = document.getElementById('base36Input');
        const convertBtn = document.getElementById('convertBtn');
        const clearBtn = document.getElementById('clearBtn');
        const randomBtn = document.getElementById('randomBtn');
        const maxUint8Btn = document.getElementById('maxUint8Btn');
        const maxUint16Btn = document.getElementById('maxUint16Btn');
        const maxUint32Btn = document.getElementById('maxUint32Btn');
        const valueInfo = document.getElementById('valueInfo');
        const asciiDisplay = document.getElementById('asciiDisplay');
        const asciiPlaceholder = document.getElementById('asciiPlaceholder');
        const bitDisplay = document.getElementById('bitDisplay');
        
        // Input validation
        const validators = {
            bin: (v) => /^[01]+$/.test(v),
            oct: (v) => /^[0-7]+$/.test(v),
            dec: (v) => /^-?\d+$/.test(v),
            hex: (v) => /^[0-9a-fA-F]+$/.test(v),
            base36: (v) => /^[0-9a-zA-Z]+$/.test(v)
        };
        
        // Convert between bases
        function convertFromDec(dec) {
            const num = BigInt(dec);
            return {
                bin: num.toString(2),
                oct: num.toString(8),
                dec: dec,
                hex: num.toString(16).toUpperCase(),
                base36: num.toString(36).toUpperCase()
            };
        }
        
        function convertToDec(value, base) {
            try {
                return BigInt('0x' + BigInt(value).toString(16)).toString();
            } catch (e) {
                try {
                    return BigInt(value).toString();
                } catch (e2) {
                    return null;
                }
            }
        }
        
        function parseInput(value, base) {
            try {
                if (base === 2) return BigInt('0b' + value).toString();
                if (base === 8) return BigInt('0o' + value).toString();
                if (base === 10) return value;
                if (base === 16) return BigInt('0x' + value).toString();
                if (base === 36) return BigInt(value, 36).toString();
            } catch (e) {
                return null;
            }
            return null;
        }
        
        // Update all inputs
        function updateAllInputs(source, value) {
            if (!value || isNaN(value)) {
                return;
            }
            
            const results = convertFromDec(value);
            
            if (source !== 'bin') binInput.value = results.bin;
            if (source !== 'oct') octInput.value = results.oct;
            if (source !== 'dec') decInput.value = results.dec;
            if (source !== 'hex') hexInput.value = results.hex;
            if (source !== 'base36') base36Input.value = results.base36;
            
            updateInfo(value, results);
            updateBitDisplay(results.bin);
            updateAscii(results.dec);
        }
        
        // Update value info
        function updateInfo(dec, results) {
            const num = BigInt(dec);
            const isNegative = dec.startsWith('-');
            const absNum = isNegative ? num * -1n : num;
            
            let info = `
                <div class="row">
                    <div class="col-6">
                        <div class="stat-item mb-2">
                            <strong>ç»å¯¹å€¼:</strong> ${absNum.toString()}
                        </div>
                        <div class="stat-item mb-2">
                            <strong>å­—èŠ‚æ•°:</strong> ${Math.ceil(absNum.toString().length / 2)} bytes
                        </div>
                        <div class="stat-item mb-2">
                            <strong>ä½(bit):</strong> ${results.bin.length} bits
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="stat-item mb-2">
                            <strong>åŸç :</strong> <code>${isNegative ? '1' : '0'}${results.bin.slice(-Math.max(8, results.bin.length % 8 || 8)).padStart(Math.max(8, results.bin.length % 8 || 8), '0')}</code>
                        </div>
                        <div class="stat-item mb-2">
                            <strong>è¡¥ç :</strong> <code>${isNegative ? twosComplement(results.bin) : results.bin.slice(-Math.max(8, results.bin.length % 8 || 8)).padStart(Math.max(8, results.bin.length % 8 || 8), '0')}</code>
                        </div>
                    </div>
                </div>
            `;
            
            valueInfo.innerHTML = info;
        }
        
        // Two's complement
        function twosComplement(bin) {
            let inverted = bin.split('').map(b => b === '0' ? '1' : '0').join('');
            let carry = 1;
            let result = '';
            for (let i = inverted.length - 1; i >= 0; i--) {
                let bit = parseInt(inverted[i]) + carry;
                result = (bit % 2) + result;
                carry = Math.floor(bit / 2);
            }
            return result || '0';
        }
        
        // Update bit display
        function updateBitDisplay(bin) {
            let html = '';
            const bits = bin.replace('-', '').padStart(8, '0');
            
            for (let i = 0; i < bits.length; i += 8) {
                const byte = bits.slice(i, i + 8);
                html += `<div><div class="byte-group">`;
                for (let j = 0; j < byte.length; j++) {
                    const bitIndex = i + j + 1;
                    html += `<div class="bit bit-${byte[j]}" title="Bit ${bitIndex}: ${byte[j]}">${byte[j]}</div>`;
                }
                html += `</div><div class="byte-label">Byte ${Math.floor(i / 8) + 1}</div></div>`;
            }
            
            bitDisplay.innerHTML = html;
        }
        
        // Update ASCII display
        function updateAscii(dec) {
            try {
                const num = parseInt(dec);
                if (num < 0 || num > 0x10FFFF) {
                    asciiDisplay.style.display = 'none';
                    asciiPlaceholder.style.display = 'block';
                    asciiPlaceholder.textContent = 'Unicode èŒƒå›´: 0x000000 - 0x10FFFF';
                    return;
                }
                
                if (num <= 0xFFFF) {
                    const char = String.fromCharCode(num);
                    const hex = num.toString(16).padStart(4, '0');
                    const decStr = num.toString();
                    const charDisplay = char.match(/[\x20-\x7E]/) ? char : '?';
                    
                    asciiDisplay.style.display = 'block';
                    asciiPlaceholder.style.display = 'none';
                    asciiDisplay.innerHTML = `
                        <div class="ascii-row">
                            <div class="ascii-item"><strong>å­—ç¬¦:</strong> ${charDisplay}</div>
                            <div class="ascii-item"><strong>Unicode:</strong> U+${hex}</div>
                            <div class="ascii-item"><strong>åè¿›åˆ¶:</strong> ${decStr}</div>
                        </div>
                        <div class="ascii-row">
                            <div class="ascii-item"><strong>HTMLå®ä½“:</strong> &#${decStr};</div>
                            <div class="ascii-item"><strong>UTF-16:</strong> ${hex}</div>
                        </div>
                    `;
                } else {
                    const hex = num.toString(16).toUpperCase().padStart(6, '0');
                    asciiDisplay.style.display = 'block';
                    asciiPlaceholder.style.display = 'none';
                    asciiDisplay.innerHTML = `
                        <div class="ascii-row">
                            <div class="ascii-item"><strong>Unicode:</strong> U+${hex}</div>
                            <div class="ascii-item"><strong>åè¿›åˆ¶:</strong> ${num}</div>
                            <div class="ascii-item"><strong>UTF-32:</strong> ${hex}</div>
                        </div>
                    `;
                }
            } catch (e) {
                asciiDisplay.style.display = 'none';
                asciiPlaceholder.style.display = 'block';
                asciiPlaceholder.textContent = 'æ— æ•ˆçš„ Unicode ç¼–ç ';
            }
        }
        
        // Convert
        function convert(source) {
            const input = document.getElementById(source + 'Input');
            const value = input.value.trim();
            
            if (!value) return;
            
            // Validate
            if (!validators[source](value)) {
                input.classList.add('is-invalid');
                setTimeout(() => input.classList.remove('is-invalid'), 1000);
                return;
            }
            
            const dec = parseInput(value, { bin: 2, oct: 8, dec: 10, hex: 16, base36: 36 }[source]);
            
            if (dec === null) {
                alert('æ— æ•ˆçš„æ•°å€¼');
                return;
            }
            
            updateAllInputs(source, dec);
        }
        
        // Event listeners
        binInput.addEventListener('input', () => convert('bin'));
        octInput.addEventListener('input', () => convert('oct'));
        decInput.addEventListener('input', () => convert('dec'));
        hexInput.addEventListener('input', () => convert('hex'));
        base36Input.addEventListener('input', () => convert('base36'));
        
        convertBtn.addEventListener('click', function() {
            const value = decInput.value || binInput.value || octInput.value || hexInput.value || base36Input.value;
            if (value) {
                const source = decInput.value ? 'dec' : binInput.value ? 'bin' : octInput.value ? 'oct' : hexInput.value ? 'hex' : 'base36';
                convert(source);
            }
        });
        
        clearBtn.addEventListener('click', function() {
            binInput.value = '';
            octInput.value = '';
            decInput.value = '';
            hexInput.value = '';
            base36Input.value = '';
            valueInfo.innerHTML = '<div class="text-muted text-center py-4">è¾“å…¥æ•°å€¼åæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</div>';
            bitDisplay.innerHTML = '';
            asciiDisplay.style.display = 'none';
            asciiPlaceholder.style.display = 'block';
        });
        
        randomBtn.addEventListener('click', function() {
            const value = Math.floor(Math.random() * 4294967296);
            decInput.value = value;
            updateAllInputs('dec', value.toString());
        });
        
        maxUint8Btn.addEventListener('click', function() {
            decInput.value = '255';
            updateAllInputs('dec', '255');
        });
        
        maxUint16Btn.addEventListener('click', function() {
            decInput.value = '65535';
            updateAllInputs('dec', '65535');
        });
        
        maxUint32Btn.addEventListener('click', function() {
            decInput.value = '4294967295';
            updateAllInputs('dec', '4294967295');
        });
    </script>
    <script src="../js/main.js"></script>
</body>
</html>
